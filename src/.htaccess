##
#
# Custom 404 error page
#
##
ErrorDocument 404 /404.php

RewriteEngine On
RewriteBase /

##
#	
# Redirect to canonical name (without www.)
#
##
RewriteCond %{HTTP_HOST} ^www\.(.+)
RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

##
# 
# Clean URLs
#
# e.g. /guiding.php -> /guiding & /guiding.php?action=walkingtours -> /guiding/walkingtours
#
##
#RewriteCond %{REQUEST_URI} !^.*min/.+
RewriteRule ^([a-z0-9\-]+)$ /$1.php [QSA]	
RewriteRule ^([a-z0-9\-]+)/([a-z0-9\-]+)$ /$1.php?action=$2 [QSA]

##
# 
# Compression.
#
# Deflate text type files.
#
##
<ifModule mod_deflate.c>
	#
	# match by file extensions
	#
    <filesMatch "\.(js|min\.js|css|html|php|svg)$">
        SetOutputFilter DEFLATE
    </filesMatch>
	<IfModule mod_mime.c>
		AddType application/javascript .js
		AddType text/javascript .js
		Addtype font/opentype .otf
		Addtype font/eot .eot
		Addtype font/truetype .ttf
	    AddType application/x-font-woff .woff
	    AddType text/xml svg svgz
	    AddEncoding gzip svgz
	</IfModule>

	#
	# catch any others with mime types
	#
	AddOutputFilterByType DEFLATE image/svg+xml
	AddOutputFilterByType DEFLATE text/plain
	AddOutputFilterByType DEFLATE text/text
	AddOutputFilterByType DEFLATE text/html
	AddOutputFilterByType DEFLATE text/xml
	AddOutputFilterByType DEFLATE text/css
	AddOutputFilterByType DEFLATE text/javascript
	AddOutputFilterByType DEFLATE application/xml
	AddOutputFilterByType DEFLATE application/xhtml+xml
	AddOutputFilterByType DEFLATE application/rss+xml
	AddOutputFilterByType DEFLATE application/javascript
	AddOutputFilterByType DEFLATE application/x-javascript
	AddOutputFilterByType DEFLATE font/opentype
	AddOutputFilterByType DEFLATE font/truetype
	AddOutputFilterByType DEFLATE font/eot
</ifModule>

##
#
# Ensure character set is specified
#
##
#AddCharset UTF-8 .map
AddType 'application/javascript; charset=UTF-8' map

##
#
# Caching.
#
# Set cache expiry for different file types
#
##

# images
<FilesMatch "\.(ico|jpg|jpeg|png|gif)$">
<IfModule mod_expires.c>
 FileETag None
 ExpiresActive on
 ExpiresDefault "access plus 1 week"
 Header set Cache-Control "public"
</IfModule>
</FilesMatch>

# fonts
<FilesMatch "\.(svg|woff|ttf|otf|eot)(#.+)?$">
<IfModule mod_expires.c>
 FileETag None
 ExpiresActive on
 ExpiresDefault "access plus 1 week"
 Header set Cache-Control "public"
</IfModule>
</FilesMatch>


# javascript (more time for jquery)
<FilesMatch "\.(js)$">
<IfModule mod_expires.c>
 FileETag None
 ExpiresActive on
 ExpiresDefault "access plus 30 minutes" 
 Header set Cache-Control "public"
</IfModule>
</FilesMatch>

<FilesMatch "(jquery-|jquery\.).*\.(js)$">
<IfModule mod_expires.c>
 FileETag None
 ExpiresActive on
 ExpiresDefault "access plus 1 week" 
 Header set Cache-Control "public"
</IfModule>
</FilesMatch>

# css
<FilesMatch "\.(css)$">
<IfModule mod_expires.c>
 FileETag None
 ExpiresActive on
 ExpiresDefault "access plus 30 minutes" 
 Header set Cache-Control "public"
</IfModule>
</FilesMatch>

#
# TMP - Force JS to be non-cached
#
#<filesMatch "\.(js|css)$">
#FileETag None
#<ifModule mod_headers.c>
#Header unset ETag
#Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
#Header set Pragma "no-cache"
#Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
#</ifModule>
#</filesMatch>